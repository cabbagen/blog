
### 一、数据模型介绍

在 mongodb 中，数据模型的 schema 定义是相对灵活的。不像是 mysql，需要在插入数据之前定义并声明好数据表的 schema。 mongodb 的 collection 并不关注 document 的结构。但是在实际应用中，一个 collection 中的 document 往往有着相同的 schema。

数据建模的关键是要平衡应用程序的需求，数据库引擎的性能特征和数据检索的模式。
当设计数据模型的时候，总要考虑应用程序对于数据的使用（例如查询、更新和数据处理）而不是继承数据自身的结构。


### 二、文档结构

为 mongodb 应用程序设计数据模型的关键围绕文档结构以及应用程序如何表示数据之间的关系。

> 引用

引用通过将链接或引用从一个文档包含到另一个文档来存储数据之间的关系。应用程序可以解析这些引用以访问相关数据。从广义上讲，这些是标准化数据模型。

![image](https://docs.mongodb.com/v3.6/_images/data-model-normalized.bakedsvg.svg)

> 嵌入数据

嵌入式文档通过在单个文档结构中存储相关数据来捕获数据之间的关系。 MongoDB文档可以将文档结构嵌入文档中的字段或数组中。这些非规范化数据模型允许应用程序在单个数据库操作中检索和操作相关数据。

![image](https://docs.mongodb.com/v3.6/_images/data-model-denormalized.bakedsvg.svg)


### 三、写操作的原子性

在 mongodb 中，在文档级别写操作是原子性的，并且没有一个写操作可以原子地影响多个文档或多个集合。具有嵌入数据的非规范化数据模型将表示的实体的所有相关数据组合在单个文档中。这有利于原子写操作，因为单个写操作可以插入或更新实体的数据。规范化数据会将数据拆分为多个集合，并且需要多个非原子集中的写入操作。

但是，促进原子写入的模式（嵌入模式）可能会限制应用程序可以使用数据的方式，或者可能限制修改应用程序的方法