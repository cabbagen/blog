
#### 一、关于 oplog

oplog(opecations log) 是一个封顶集合，记录了一系列对于数据的操作。mongodb 在 primary 节点调用相关的数据库操作，并且将他们记录在 promary 节点的 oplog 上面。其余的成员节点在一个异步的进程中拷贝并执行这些操作。所有的复制集成员都拥有 oplog 的一个副本。

为了方便复制，所有的副本集成员会向其他成员发送心跳，成员节点也可以从其他成员那里导入 oplog

在 oplog 中的操作是幂等的。这意味着向目标数据集合调用多次操作，与调用一次操作，状况是相同的。


#### 二、oplog size

当你首次开始一个复制集时，mongodb 创建了一个默认大小的 oplog

![image](https://img.laobai.com/jianbao/website/2018/06/25/15/a61937ffc1da4e29b2fd46869d101392.jpg)

在大多数的情况下，默认的大小是合适的。如果你能预测到你的复制集的工作负载符合下面的条件，那么你可能需要创建比默认 oplog 还要的大的 oplog。反之，如果你的应用主要是读操作，和少量的写操作，那么默认大小的 oplog，应该是适合你的。

* 一次更新多个文档

*  删除与插入的数据量相当

*  大量的更新操作


#### 三、复制集数据同步

为了维护共享数据集的最新副本，复制集的次要节点从其他的成员处同步或者复制数据。mongodb 使用两种方式同步数据。

* 初始化同步：将全部的数据填充到一个新的成员节点。

* 对整个数据集应用正在进行的更改，进行复制。
  
