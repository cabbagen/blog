#### 一、关于索引

索引是一个单独的、存储在磁盘上的数据库结构，他们包含着对数据表里所有的记录的引用指针。使用指针用于快速找出在某个或者多个列中有一特定值的行，所有的 mysql 列类型都可以被索引，对相关列使用索引是提高查询操作速度的最佳途径。

索引是在存储引擎中实现的。因此，每种存储引擎的索引都不一定完全相同，并且每种存储引擎也不一定支持所有索引类型。根据存储引擎定义每个表的最大索引数和最大索引长度。所有的存储引擎支持每个表至少 16 个索引，总索引长度至少为 256 字节。大多数存储引擎有更高的限制。mysql 中索引的存储类型有两种：BTREE 和 hash，具体和表的存储引擎相关；MyISAM 和 InnoDB 存储引擎只支持 BTREE索引，MEMORY 和 HEAP 存储引擎可以支持 HASH 和 BTREE 索引。

> 索引的优点
>
> * 通过创建唯一索引，可以保证数据库表中每一行数据的唯一性。
>
> * 可以大大加快数据的查询速度，这也是创建索引的最主要原因。
>
> * 在实现数据的参考完整性方面，可以加速表和表之间的链接。
>
> * 在使用分组和排序子句进行数据查询时，也可以显著减少查询中分组和排序的时间。
>
> 索引的缺点
> 
> * 创建索引和维护索引要耗费时间，并且随着数据量的增加所耗费的时间也会增加。
>
> * 索引需要占磁盘空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果有大量的索引，索引文件可能比数据文件更快到达最大文件尺寸。
>
> * 当对表中的数据进行增加、删除、和修改的时候，索引也要动态的维护，这样就降低了数据的维护速度。


#### 二、索引的设计原则

索引设计不合理或者缺少索引都会对数据库和应用程序的性能造成障碍。高效的索引对于获得良好的性能非常重要。设计索引时，应该考虑一下原则：

* 索引并非越多越好，一个表中如有大量的索引，不仅占用磁盘空间，而且会影响 *INSERT*、*DELETE*、*UPDATE* 等语句的性能，因为当表中的数据更改的同时，索引也会进行调整和更新。

* 避免对经常更新的表进行过多的索引，并且索引中的列尽可能少。而对经常用于查询的字段应该创建索引，但要避免添加不必要的字段。

* 数据量小的表最好不要使用索引，由于数据较少，查询花费的时间可能比遍历索引的时间还要短，索引可能不会产生优化的效果。

* 在条件表达式中经常用到的不同值较多的列上建立索引，在不同值很少的列上不要建立索引。比如在学生表的 “性别” 字段上只有 “男” 与 “女” 两个不同值，因此就无须建立索引。如果建立索引不但不会提高查询效率，反而会严重降低数据更新速度。

* 当唯一性是某种数据本身的特性时，指定唯一索引。使用唯一索引需能确保定义列的数据完整性，以提高查询速度。

* 在频繁进行排序或分组（即进行 group by 或者 order by 操作）的列上建立索引，如果待排序的列有多个，可以在这些列上建立组合索引。 


#### 三、mysql 索引

##### （一）索引的分类

1、普通索引和唯一索引

> 普通索引是 mysql 中基本索引类型，允许在定义索引的列中插入重复值和空值。   
> 唯一索引，索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。主键索引是一种特殊的唯一索引，不允许有空值。


2、单列索引和组合索引

> 单列索引即一个索引只包含单个列，一个表可以有多个单列索引。     
> 组合索引指在表的多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段时，索引才会被使用。使用组合索引时遵循最左前缀集合。


3、全文索引

> 全文索引类型问 FULLTEXT，在定义索引的列上支持值的全文查找，允许在这些索引列中插入重复值和空值。全文索引可以在 *CHAR*、*VARCHAR*、*TEXT* 类型的列上创建。mysql 中只有 MyISAM 存储引擎支持全文索引。


4、空间索引

> 空间索引是对空间数据类型的字段建立的索引，mysql 中的空间数据类型有 4 种，分别是： *GEOMETRY*、*POINT*、*LINESTRING*、*POLYGON*。mysql 使用 SPATIAL 关键字进行扩展，使得能够用于创建正规索引类似的语法创建空间索引。创建空间索引，必须将其声明为 *NOT NULL*，空间索引只能在存储引擎为 MyISAM 的表中创建。


##### （二）mysql 索引创建

1、在创建表的时候添加索引

````
/**
 * UNIQUE、FULLTEXT 和 SPATIAL 为可选参数，分别表示唯一索引、全文索引、空间索引
 * INDEX 和 KEY 同义，用来指定创建索引
 * col_name 为需要创建索引的字段列，该列必须从数据表中定义的多个列中选择
 * index_name 指定索引的名称，为可选参数，如果不指定，默认为 col_name
 * length 为可选参数，表示索引长度，只有字符串类型才可指定
 * ASC 或 DESC 指定升序或者降序索引值存储
 */
 CREATE TABLE table_name (
    col_name       data_type
    [UNIQUE|FULLTEXT|SPATIAL] [INDEX|KEY] [index_name] (col_name [length]) [ASC|DESC]
);


// 查看索引
SHOW CREATE TABLE table_name
// 或者
SHOW INDEX FROM table_name\G;


// 分析 索引状态
EXPLAIN SELECT * FROM table_name\G;

````

2、在已存在的表上添加索引
````
// 使用 alter table 语句创建索引
ALTER TABLE table_name ADD [UNIQUE|FULLTEXT|SPATIAL] [INDEX|KEY] [index_name]  (col_name[length],...) [ASC|DESC]

// 使用 create index 创建索引
// create index 语句可以在已经存在的表上添加索引
// mysql 中 create index 被映射到一个 alter table 语句上
CREATE [UNIQUE|FULLTEXT|SPATIAL] INDEX index_name on table_name (col_name[lenth],...) [ASC|DESC]

````

##### （三）mysql 删除索引

mysql 中删除索引使用 **alter table** 或者 **drop index** 语句，两者可实现相同的功能，**drop index** 语句在内部被映射到一个 **alter table** 语句中。

````
// 使用 alter table 删除索引
ALTER TABLE table_name DROP INDEX index_name

// 使用 drop index 语句删除索引
DROP INDEX index_name ON table_name
````