
### 一、概述
mysql replication 是 mysql 的一个非常重要的功能，主要用于主服务器和从服务器之间的数据复制操作。

mysql 从3.25.15 版本开始提供数据库复制功能。mysql 复制是指从一个 mysql 主服务器（master）将数据复制到另一台或多台mysql从服务器（slaves）的过程，将主服务器的 DDL 和 DML 操作通过二进制日志传到复制服务器上，然后在从服务器上对这些日志重新执行，从而使的主服务器的数据保持同步。

在 mysql 中，复制操作是异步进行的，slaves 服务器不需要持续的保持连接接收 msater 服务器数据。

mysql 支持一台主服务器同时向多台从服务器进行复制操作，从服务器同时可以作为其它从服务器的主服务器，如果 mysql 主服务器访问量比较大，可以通过复制数据，然后在从服务器上进行查询，从而降低主服务器的访问压力，同时从服务器作为主服务器的备份，可以避免主服务器因为故障数据丢失的问题。

mysql 数据库复制操作大致可以分成三个步骤：

* 主服务器将数据的改变记录到二进制日志中。

* 从服务器将主服务器的 binary log events 复制到它的中继日志中。

* 从服务器重做中继日志中的事件，将数据的改变与从服务器保持同步。首先，主服务器器会记录二进制日志，每个事务更新数据完成之前，主服务器将这些操作的信息记录在二进制日志里面，在事件写入二进制日志完成后，主服务器通知存储引擎提交事务。

 
slave 上面的 I/O 进程连接上 Master，并发出日志请求，Master 接收来自 slave 的 I/O 进程的请求后，通过负责复制的 I/O 进程根据请求信息读取与制定日志指定位置之后的日志信息，返回给 slave 的 I/O 进程。返回信息中除了日志所包含的信息之外，还包括本次返回的信息已经到 Master 端的 bin-log 文件的名称以及 bin-log 的位置。

slave 的 I/O进程接收到信息后，将接收到的日志内容依次添加到 slave 端的 relay-log 文件的最末端，并将读取到 Master 端的 bin-log 的文件名和位置记录到 master-info 文件中。

slave 的 SQL 进程检测到 relay-log 中新增加了内容后，会马上解析 relay-log 的内容成为在 Master 端真实执行时候的那些可执行的内容，并在自身执行。

Mysql 复制环境 90% 以上都是一个 Master 带一个或者多个 Slave 的架构模式。如果 master 和 slave 的压力不是太大的话，异步复制的延时一般都很少。尤其是 slave 端的复制方式改成两个进程处理后，更是减小了 slave 端的延时。

对于数据实时要求不是特别严格的应用，只需要通过廉价的电脑服务器来扩展 slave的数据，将读压力分散到多台 slave 的机器上面，即可解决数据库端的读压力瓶颈。

